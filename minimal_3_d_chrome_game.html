<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Green School Runner</title>
  <style>
    html,body{height:100%;margin:0;background:#2e7d32;color:#fff;font-family:sans-serif;overflow:hidden}
    #ui{position:fixed;left:12px;top:12px;z-index:2}
    #score{font-weight:700}
    #boostTimer{margin-top:4px;font-size:14px;color:yellow}
    #gameOverScreen{position:fixed;inset:0;background:rgba(0,0,0,0.85);color:#fff;display:none;flex-direction:column;align-items:center;justify-content:center;z-index:5;font-family:sans-serif}
    #gameOverScreen h1{font-size:48px;margin:0 0 20px}
    #gameOverScreen p{font-size:20px;margin:0 0 20px}
    canvas{display:block}
    button{margin-top:6px}
  </style>
</head>
<body>
  <div id="ui">
    <div>Score: <span id="score">0</span></div>
    <div id="boostTimer"></div>
    <div style="margin-top:6px;font-size:13px;opacity:.9">Controls: Arrow keys / A D to move, Space to jump</div>
    <button id="restart">Restart</button>
  </div>
  <div id="gameOverScreen">
    <h1>Game Over</h1>
    <p id="finalScore">Your Score: 0</p>
    <button id="restartGameOver">Restart</button>
  </div>
  <canvas id="game"></canvas>
  <script>
    const canvas=document.getElementById('game');
    const ctx=canvas.getContext('2d');
    let W,H;
    function resize(){W=innerWidth;H=innerHeight;canvas.width=W;canvas.height=H}
    window.addEventListener('resize',resize);resize();

    const characters=["ðŸ‘¦","ðŸ§‘"];
    let currentChar=characters[Math.floor(Math.random()*characters.length)];

    let player={x:100,y:0,w:50,h:70,vy:0,onGround:false,frame:0,animTimer:0,highJump:false,speedBoost:false,boostTimer:0};
    let gravity=0.6;
    let groundY=H-100;
    let obstacles=[];
    let powerups=[];
    let score=0;
    let gameOver=false;
    let levelMessage="";
    let levelTimer=0;
    const scoreEl=document.getElementById('score');
    const restartBtn=document.getElementById('restart');
    const gameOverScreen=document.getElementById('gameOverScreen');
    const finalScore=document.getElementById('finalScore');
    const restartGameOver=document.getElementById('restartGameOver');
    const boostTimerEl=document.getElementById('boostTimer');

    restartBtn.onclick=()=>reset();
    restartGameOver.onclick=()=>{gameOverScreen.style.display="none";reset();}

    const keys={};
    window.addEventListener('keydown',e=>{keys[e.key.toLowerCase()]=true});
    window.addEventListener('keyup',e=>{keys[e.key.toLowerCase()]=false});

    function spawnObstacle(){
      let height=player.h;
      let type=Math.random()<0.5?"bamboo":"sugarcane";
      obstacles.push({x:W+20,y:groundY-height,w:30,h:height,type});
    }

    function spawnPowerup(){
      let type=Math.random()<0.5?"highJump":"speed";
      if(Math.random()<0.002){
        powerups.push({x:W+20,y:groundY-40,w:30,h:30,type});
      }
    }

    function reset(){
      currentChar=characters[Math.floor(Math.random()*characters.length)];
      player.x=100;player.y=groundY-player.h;player.vy=0;score=0;obstacles=[];powerups=[];gameOver=false;scoreEl.textContent=0;
      levelMessage="";levelTimer=0;player.highJump=false;player.speedBoost=false;player.boostTimer=0;boostTimerEl.textContent="";
    }

    function getDifficulty(){
      if(score<20) return {speed:5,spawn:0.025,level:"Easy Mode",bg:["#a8edea","#2e7d32"]};
      if(score<40) return {speed:6,spawn:0.035,level:"Medium Level 1",bg:["#66bb6a","#43a047"]};
      if(score<60) return {speed:7,spawn:0.045,level:"Medium Level 2",bg:["#81c784","#388e3c"]};
      if(score<80) return {speed:8,spawn:0.055,level:"Hard Level 1",bg:["#66bb6a","#2e7d32"]};
      if(score<120) return {speed:10,spawn:0.065,level:"Hard Level 2",bg:["#4caf50","#1b5e20"]};
      return {speed:12,spawn:0.08,level:"Extreme Mode",bg:["#2e7d32","#0d3d0d"]};
    }

    function update(){
      if(gameOver) return;
      let jumpPower=player.highJump?-20:-14;
      let moveSpeed=player.speedBoost?10:5;
      if((keys['arrowup']||keys[' ']||keys['w'])&&player.onGround){player.vy=jumpPower;player.onGround=false}
      if(keys['arrowleft']||keys['a'])player.x-=moveSpeed;
      if(keys['arrowright']||keys['d'])player.x+=moveSpeed;
      player.vy+=gravity;player.y+=player.vy;
      if(player.y+player.h>=groundY){player.y=groundY-player.h;player.vy=0;player.onGround=true}

      if(player.boostTimer>0){
        player.boostTimer--;
        boostTimerEl.textContent="Potion Time: "+Math.ceil(player.boostTimer/60)+"s";
        if(player.boostTimer===0){player.highJump=false;player.speedBoost=false;boostTimerEl.textContent="";}
      }

      player.animTimer++;
      if(player.animTimer>10){player.frame=(player.frame+1)%2;player.animTimer=0;}

      const diff=getDifficulty();

      for(let i=obstacles.length-1;i>=0;i--){
        let o=obstacles[i];
        o.x-=diff.speed;
        if(o.x+o.w<0){obstacles.splice(i,1);score++;scoreEl.textContent=score;
          if([20,40,60,80,120].includes(score)){
            levelMessage=diff.level;
            levelTimer=120;
          }
          continue}
        if(player.x<o.x+o.w&&player.x+player.w>o.x&&player.y<o.y+o.h&&player.y+player.h>o.y){
          if(player.x<o.x){player.x=o.x-player.w}
          else if(player.x>o.x){player.x=o.x+o.w}
        }
      }

      for(let i=powerups.length-1;i>=0;i--){
        let p=powerups[i];
        p.x-=diff.speed;
        if(p.x+p.w<0){powerups.splice(i,1);continue;}
        if(player.x<p.x+p.w&&player.x+player.w>p.x&&player.y<p.y+p.h&&player.y+player.h>p.y){
          if(p.type==="highJump")player.highJump=true;
          if(p.type==="speed")player.speedBoost=true;
          player.boostTimer=600;
          powerups.splice(i,1);
        }
      }

      if(player.x<0||player.x+player.w>W||player.y<0||player.y+player.h>H){
        gameOver=true;
        finalScore.textContent="Your Score: "+score;
        gameOverScreen.style.display="flex";
      }
      if(Math.random()<diff.spawn)spawnObstacle();
      spawnPowerup();
      if(levelTimer>0) levelTimer--;
    }

    function draw(){
      ctx.clearRect(0,0,W,H);
      const diff=getDifficulty();
      let bgGrad=ctx.createLinearGradient(0,0,W,H);
      bgGrad.addColorStop(0,diff.bg[0]);
      bgGrad.addColorStop(1,diff.bg[1]);
      ctx.fillStyle=bgGrad;
      ctx.fillRect(0,0,W,H);
      ctx.fillStyle="#2e7d32";
      ctx.fillRect(0,groundY,W,H-groundY);

      ctx.font="50px serif";
      ctx.textAlign="center";
      ctx.fillText(currentChar,player.x+player.w/2,player.y+player.h-5);

      for(const o of obstacles){
        if(o.type==="bamboo"){
          ctx.fillStyle="#558b2f";
          ctx.fillRect(o.x,o.y,o.w,o.h);
          ctx.strokeStyle="#33691e";
          ctx.beginPath();
          ctx.moveTo(o.x,o.y);
          ctx.lineTo(o.x,o.y+o.h);
          ctx.stroke();
        } else {
          ctx.fillStyle="#a5d6a7";
          ctx.fillRect(o.x,o.y,o.w,o.h);
          ctx.strokeStyle="#2e7d32";
          ctx.beginPath();
          ctx.moveTo(o.x,o.y);
          ctx.lineTo(o.x,o.y+o.h);
          ctx.stroke();
        }
      }

      for(const p of powerups){
        ctx.fillStyle=p.type==="highJump"?"#4caf50":"#81c784";
        ctx.beginPath();
        ctx.rect(p.x,p.y,p.w,p.h);
        ctx.fill();
        ctx.fillStyle="#fff";
        ctx.font="20px sans-serif";
        ctx.fillText("ðŸ¾",p.x+p.w/2,p.y+p.h-5);
      }

      ctx.fillStyle="#fff";
      ctx.font="bold 22px sans-serif";
      ctx.fillText("ðŸŒ¿ Green School Runner ðŸŒ¿",W/2,40);
      if(levelTimer>0){
        ctx.font="bold 40px sans-serif";
        ctx.fillStyle="yellow";
        ctx.fillText(levelMessage,W/2,H/2);
      }
    }

    function loop(){
      update();draw();requestAnimationFrame(loop);
    }

    reset();loop();
  </script>
</body>
